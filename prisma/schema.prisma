generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum NR {
  NR_05
  NR_06
  NR_10
  NR_11
  NR_12
  NR_18
  NR_20
  NR_33
  NR_35
}

model Colaborador {
  id        String  @id @default(cuid())
  nome      String
  setor     String
  cargo     String
  matricula String? @unique

  asos        ASO[]
  treinamentos Treinamento[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([nome])
  @@index([setor])
}

model TipoASO {
  id            String  @id @default(cuid())
  nome          String
  validadeMeses Int?
  descricao     String?

  asos ASO[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([nome])
}

model ASO {
  id String @id @default(cuid())

  // Relação (Base44 não obriga, então fica opcional)
  colaborador_id String?
  colaborador    Colaborador? @relation(fields: [colaborador_id], references: [id], onDelete: SetNull)

  // Cache/snapshot (Base44 exige colaborador_nome)
  colaborador_nome String
  setor            String?
  cargo            String?

  // TipoASO (opcional + cache)
  tipoASO_id   String?
  tipoASO      TipoASO? @relation(fields: [tipoASO_id], references: [id], onDelete: SetNull)
  tipoASO_nome String?

  data_aso     DateTime
  validade_aso DateTime?

  clinica    String?
  observacao String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([colaborador_id])
  @@index([tipoASO_id])
  @@index([data_aso])
  @@index([validade_aso])
}

model TipoTreinamento {
  id            String  @id @default(cuid())
  nome          String
  nr            String
  validadeMeses Int?
  descricao     String?

  treinamentos Treinamento[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([nr, nome])
  @@index([nr])
}

model Treinamento {
  id String @id @default(cuid())

  // Relação (Base44 não obriga, então fica opcional)
  colaborador_id String?
  colaborador    Colaborador? @relation(fields: [colaborador_id], references: [id], onDelete: SetNull)

  // Cache/snapshot (Base44 exige colaborador_nome)
  colaborador_nome String

  // Relação com TipoTreinamento (no Base44 o campo se chama "tipoTreinamento")
  tipoTreinamento String?
  tipoTreinamentoRel TipoTreinamento? @relation(fields: [tipoTreinamento], references: [id], onDelete: SetNull)

  // NR legado (enum fixo)
  nr NR?

  data_treinamento DateTime
  validade         DateTime?
  carga_horaria    Int?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([colaborador_id])
  @@index([tipoTreinamento])
  @@index([validade])
  @@index([data_treinamento])
}
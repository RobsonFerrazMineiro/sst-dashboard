generator client {
  provider = "prisma-client"
  output   = "./generated"

}

datasource db {
  provider = "postgresql"

}

model Collaborator {
  id        String   @id @default(cuid())
  name      String
  sector    String?
  role      String?
  registration String? @unique

  asos      AsoExam[]
  trainings TrainingRecord[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([name])
  @@index([sector])
}

model AsoExam {
  id             String   @id @default(cuid())
  collaboratorId String
  collaborator   Collaborator @relation(fields: [collaboratorId], references: [id], onDelete: Cascade)

  examDate       DateTime?
  validUntil     DateTime?

  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@index([collaboratorId])
  @@index([validUntil])
}

model TrainingType {
  id        String   @id @default(cuid())
  nr        String
  name      String

  trainings TrainingRecord[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([nr, name])
  @@index([nr])
}

model TrainingRecord {
  id             String   @id @default(cuid())
  collaboratorId String
  collaborator   Collaborator @relation(fields: [collaboratorId], references: [id], onDelete: Cascade)

  trainingTypeId String?
  trainingType   TrainingType? @relation(fields: [trainingTypeId], references: [id], onDelete: SetNull)

  // fallback quando nÃ£o houver tipo cadastrado
  nrFallback     String?

  trainingDate   DateTime?
  validUntil     DateTime? // null => indeterminada / sem vencimento

  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@index([collaboratorId])
  @@index([trainingTypeId])
  @@index([validUntil])
}